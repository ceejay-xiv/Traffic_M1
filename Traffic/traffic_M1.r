w1_Monday_Morning <- read_csv("Monday_Morning.csv")
w1_Tuesday_Morning<- read_csv("Tuesday_Morning.csv")
w1_Wednesday_Morning<- read_csv("Wednesday_Morning.csv")
w1_Thursday_Morning<- read_csv("Thursday_Morning.csv")
w1_Friday_Morning<- read_csv("Friday_Morning.csv")
w1_Saturday_Morning<- read_csv("Saturday_Morning.csv")
w1_Sunday_Morning<- read_csv("Sunday_Morning.csv")
w1_Monday_Noon <- read_csv("Monday_Noon.csv")
w1_Tuesday_Noon<- read_csv("Tuesday_Noon.csv")
w1_Wednesday_Noon<- read_csv("Wednesday_Noon.csv")
w1_Thursday_Noon<- read_csv("Thursday_Noon.csv")
w1_Friday_Noon<- read_csv("Friday_Noon.csv")
w1_Saturday_Noon<- read_csv("Saturday_Noon.csv")
w1_Sunday_Noon<- read_csv("Sunday_Noon.csv")
w1_Monday_Evening <- read_csv("Monday_Evening.csv")
w1_Tuesday_Evening<- read_csv("Tuesday_Evening.csv")
w1_Wednesday_Evening<- read_csv("Wednesday_Evening.csv")
w1_Thursday_Evening<- read_csv("Thursday_Evening.csv")
w1_Friday_Evening<- read_csv("Friday_Evening.csv")
w1_Saturday_Evening<- read_csv("Saturday_Evening.csv")
w1_Sunday_Evening<- read_csv("Sunday_Evening.csv")
w1_Monday_Night <- read_csv("Monday_Night.csv")
w1_Tuesday_Night<- read_csv("Tuesday_Night.csv")
w1_Wednesday_Night<- read_csv("Wednesday_Night.csv")
w1_Thursday_Night<- read_csv("Thursday_Night.csv")
w1_Friday_Night<- read_csv("Friday_Night.csv")
w1_Saturday_Night<- read_csv("Saturday_Night.csv")
w1_Sunday_Night<- read_csv("Sunday_Night.csv")


w1_Monday_Morning[1]<-dmy('04-04-2022')
w1_Tuesday_Morning[1]<-dmy('05-04-2022')
w1_Wednesday_Morning[1]<-dmy('06-04-2022')
w1_Thursday_Morning[1]<-dmy('07-04-2022')
w1_Friday_Morning[1]<-dmy('08-04-2022')
w1_Saturday_Morning[1]<-dmy('09-04-2022')
w1_Sunday_Morning[1]<-dmy('10-04-2022')
w1_Monday_Noon[1]<-dmy('04-04-2022')
w1_Tuesday_Noon[1]<-dmy('05-04-2022')
w1_Wednesday_Noon[1]<-dmy('06-04-2022')
w1_Thursday_Noon[1]<-dmy('07-04-2022')
w1_Friday_Noon[1]<-dmy('08-04-2022')
w1_Saturday_Noon[1]<-dmy('09-04-2022')
w1_Sunday_Noon[1]<-dmy('10-04-2022')
w1_Monday_Evening[1]<-dmy('04-04-2022')
w1_Tuesday_Evening[1]<-dmy('05-04-2022')
w1_Wednesday_Evening[1]<-dmy('06-04-2022')
w1_Thursday_Evening[1]<-dmy('07-04-2022')
w1_Friday_Evening[1]<-dmy('08-04-2022')
w1_Saturday_Evening[1]<-dmy('09-04-2022')
w1_Sunday_Evening[1]<-dmy('10-04-2022')
w1_Monday_Night[1]<-dmy('04-04-2022')
w1_Tuesday_Night[1]<-dmy('05-04-2022')
w1_Wednesday_Night[1]<-dmy('06-04-2022')
w1_Thursday_Night[1]<-dmy('07-04-2022')
w1_Friday_Night[1]<-dmy('08-04-2022')
w1_Saturday_Night[1]<-dmy('09-04-2022')
w1_Sunday_Night[1]<-dmy('10-04-2022')


w2_Monday_Morning <- read_csv("w2_Monday_Morning.csv")
w2_Tuesday_Morning<- read_csv("w2_Tuesday_Morning.csv")
w2_Wednesday_Morning<- read_csv("w2_Wednesday_Morning.csv")
w2_Thursday_Morning<- read_csv("w2_Thursday_Morning.csv")
w2_Friday_Morning<- read_csv("w2_Friday_Morning.csv")
w2_Saturday_Morning<- read_csv("w2_Saturday_Morning.csv")
w2_Sunday_Morning<- read_csv("w2_Sunday_Morning.csv")
w2_Monday_Noon <- read_csv("w2_Monday_Noon.csv")
w2_Tuesday_Noon<- read_csv("w2_Tuesday_Noon.csv")
w2_Wednesday_Noon<- read_csv("w2_Wednesday_Noon.csv")
w2_Thursday_Noon<- read_csv("w2_Thursday_Noon.csv")
w2_Friday_Noon<- read_csv("w2_Friday_Noon.csv")
w2_Saturday_Noon<- read_csv("w2_Saturday_Noon.csv")
w2_Sunday_Noon<- read_csv("w2_Sunday_Noon.csv")
w2_Monday_Evening <- read_csv("w2_Monday_Evening.csv")
w2_Tuesday_Evening<- read_csv("w2_Tuesday_Evening.csv")
w2_Wednesday_Evening<- read_csv("w2_Wednesday_Evening.csv")
w2_Thursday_Evening<- read_csv("w2_Thursday_Evening.csv")
w2_Friday_Evening<- read_csv("w2_Friday_Evening.csv")
w2_Saturday_Evening<- read_csv("w2_Saturday_Evening.csv")
w2_Sunday_Evening<- read_csv("w2_Sunday_Evening.csv")
w2_Monday_Night <- read_csv("w2_Monday_Night.csv")
w2_Tuesday_Night<- read_csv("w2_Tuesday_Night.csv")
w2_Wednesday_Night<- read_csv("w2_Wednesday_Night.csv")
w2_Thursday_Night<- read_csv("w2_Thursday_Night.csv")
w2_Friday_Night<- read_csv("w2_Friday_Night.csv")
w2_Saturday_Night<- read_csv("w2_Saturday_Night.csv")
w2_Sunday_Night<- read_csv("w2_Sunday_Night.csv")


w2_Monday_Morning[1]<-dmy('11-04-2022')
w2_Tuesday_Morning[1]<-dmy('12-04-2022')
w2_Wednesday_Morning[1]<-dmy('13-04-2022')
w2_Thursday_Morning[1]<-dmy('14-04-2022')
w2_Friday_Morning[1]<-dmy('15-04-2022')
w2_Saturday_Morning[1]<-dmy('16-04-2022')
w2_Sunday_Morning[1]<-dmy('17-04-2022')
w2_Monday_Noon[1]<-dmy('11-04-2022')
w2_Tuesday_Noon[1]<-dmy('12-04-2022')
w2_Wednesday_Noon[1]<-dmy('13-04-2022')
w2_Thursday_Noon[1]<-dmy('14-04-2022')
w2_Friday_Noon[1]<-dmy('15-04-2022')
w2_Saturday_Noon[1]<-dmy('16-04-2022')
w2_Sunday_Noon[1]<-dmy('17-04-2022')
w2_Monday_Evening[1]<-dmy('11-04-2022')
w2_Tuesday_Evening[1]<-dmy('12-04-2022')
w2_Wednesday_Evening[1]<-dmy('13-04-2022')
w2_Thursday_Evening[1]<-dmy('14-04-2022')
w2_Friday_Evening[1]<-dmy('15-04-2022')
w2_Saturday_Evening[1]<-dmy('16-04-2022')
w2_Sunday_Evening[1]<-dmy('17-04-2022')
w2_Monday_Night[1]<-dmy('11-04-2022')
w2_Tuesday_Night[1]<-dmy('12-04-2022')
w2_Wednesday_Night[1]<-dmy('13-04-2022')
w2_Thursday_Night[1]<-dmy('14-04-2022')
w2_Friday_Night[1]<-dmy('15-04-2022')
w2_Saturday_Night[1]<-dmy('16-04-2022')
w2_Sunday_Night[1]<-dmy('17-04-2022')


week1_Morning<-rbind.data.frame(w1_Monday_Morning, w1_Tuesday_Morning, w1_Wednesday_Morning, w1_Thursday_Morning, w1_Friday_Morning,
                                w1_Saturday_Morning, w1_Sunday_Morning)
week1_Morning[3]<-'07:30'
week1_Noon<-rbind.data.frame(w1_Monday_Noon, w1_Tuesday_Noon, w1_Wednesday_Noon, w1_Thursday_Noon, w1_Friday_Noon,
                             w1_Saturday_Noon, w1_Sunday_Noon)
week1_Noon[3]<-'13:30'
week1_Evening<-rbind.data.frame(w1_Monday_Evening, w1_Tuesday_Evening, w1_Wednesday_Evening, w1_Thursday_Evening, w1_Friday_Evening,
                                w1_Saturday_Evening, w1_Sunday_Evening)
week1_Evening[3]<-'18:30'
week1_Night<-rbind.data.frame(w1_Monday_Night, w1_Tuesday_Night, w1_Wednesday_Night, w1_Thursday_Night, w1_Friday_Night,
                              w1_Saturday_Night, w1_Sunday_Night)
week1_Night[3]<-'01:30'

week1<-rbind.data.frame(week1_Morning, week1_Noon, week1_Evening, week1_Night)

week2_Morning<-rbind.data.frame(w2_Monday_Morning, w2_Tuesday_Morning, w2_Wednesday_Morning, w2_Thursday_Morning, w2_Friday_Morning,
                                w2_Saturday_Morning, w2_Sunday_Morning)
week2_Morning[3]<-'07:30'
week2_Noon<-rbind.data.frame(w2_Monday_Noon, w2_Tuesday_Noon, w2_Wednesday_Noon, w2_Thursday_Noon, w2_Friday_Noon,
                             w2_Saturday_Noon, w2_Sunday_Noon)
week2_Noon[3]<-'13:30'
week2_Evening<-rbind.data.frame(w2_Monday_Evening, w2_Tuesday_Evening, w2_Wednesday_Evening, w2_Thursday_Evening, w2_Friday_Evening,
                                w2_Saturday_Evening, w2_Sunday_Evening)
week2_Evening[3]<-'18:30'
week2_Night<-rbind.data.frame(w2_Monday_Night, w2_Tuesday_Night, w2_Wednesday_Night, w2_Thursday_Night, w2_Friday_Night,
                              w2_Saturday_Night, w2_Sunday_Night)
week2_Night[3]<-'01:30'

week2<-rbind.data.frame(week2_Morning, week2_Noon, week2_Evening, week2_Night)

#Select the important features

week1<-week1 %>% select(1, 2, 3, 15, 20, 30, 37, 46, 51, 61, 77, 84, 99, 104, 114, 121, 131, 147, 163, 179, 194, 199,
                        209, 225, 232, 242, 258, 274, 290, 306, 322)
week2<-week2 %>% select(1, 2, 3, 15, 20, 30, 37, 46, 51, 61, 77, 84, 99, 104, 114, 121, 131, 147, 163, 179, 194, 199,
                        209, 225, 232, 242, 258, 274, 290, 306, 322)

tf_data<-rbind.data.frame(week1, week2)

names(tf_data)[1] <- "date"
names(tf_data)[3] <- "time"

tf_data<-tf_data %>% select(1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,25)

write.csv(tf_data_o, file = "C:/Users/w21007844/OneDrive - Northumbria University - Production Azure AD/Statistical Programming/API/JS/Conversion/Week1/traffic.csv")
install.packages('ggpubr')
install.packages('PerformanceAnalytics')
install.packages("splitstackshape")
library(readr)
library(tidyverse)
library(lubridate, warn.conflicts = FALSE)
library(ggplot2)
library(ggpubr)
library(naniar)

tf_data_copy<-tf_data_o
#Sampling
tf_data1 <- tf_data_o %>%
  group_by(junctionName, time) %>%
  sample_frac(size=.14)
tf_data2 <- tf_data_o %>%
  group_by(junctionName, time) %>%
  sample_frac(size=.14)
tf_data3 <- tf_data_o %>%
  group_by(junctionName, time) %>%
  sample_frac(size=.14)
tf_data4 <- tf_data_o %>%
  group_by(junctionName, time) %>%
  sample_frac(size=.14)

#Check for missingness
vis_miss(tf_data_o)
#apply(is.na(tf_data), 2, which)
mcar_test(tf_data_o)

Scatterplot1<-ggplot(
  tf_data1,
  aes(date, `primaryDownstreamJunctionSection/avgSpeed`, colour=time, group = 1)
)+
  geom_point(position="jitter", alpha=0.6)+
  facet_grid(~junctionName) + 
  scale_x_continuous(breaks=seq(0, 5, 1)) + 
  geom_boxplot(alpha=0, colour="black") +  
  scale_color_brewer(palette = "Set1")+
  labs(title = "Sample1: Junction vs Speed",caption = "Data: Traffic England/ w21007844")
plot(Scatterplot1)
Scatterplot2<-ggplot(
  tf_data2,
  aes(date, `primaryDownstreamJunctionSection/avgSpeed`, colour=time, group = 1)
)+
  geom_point(position="jitter", alpha=0.6)+
  facet_grid(~junctionName) + 
  scale_x_continuous(breaks=seq(0, 5, 1)) + 
  geom_boxplot(alpha=0, colour="black") +  
  scale_color_brewer(palette = "Set1")+
  labs(title = "Sample2: Junction vs Speed",caption = "Data: Traffic England/ w21007844")
plot(Scatterplot2)
Scatterplot3<-ggplot(
  tf_data3,
  aes(date, `primaryDownstreamJunctionSection/avgSpeed`, colour=time, group = 1)
)+
  geom_point(position="jitter", alpha=0.6)+
  facet_grid(~junctionName) + 
  scale_x_continuous(breaks=seq(0, 5, 1)) + 
  geom_boxplot(alpha=0, colour="black") +  
  scale_color_brewer(palette = "Set1")+
  labs(title = "Sample3: Junction vs Speed",caption = "Data: Traffic England/ w21007844")
plot(Scatterplot3)
Scatterplot4<-ggplot(
  tf_data4,
  aes(date, `primaryDownstreamJunctionSection/avgSpeed`, colour=time, group = 1)
)+
  geom_point(position="jitter", alpha=0.6)+
  facet_grid(~junctionName) + 
  scale_x_continuous(breaks=seq(0, 5, 1)) + 
  geom_boxplot(alpha=0, colour="black") +  
  scale_color_brewer(palette = "Set1")+
  labs(title = "Sample4: Junction vs Speed",caption = "Data: Traffic England/ w21007844")
plot(Scatterplot4)

#check moct
avg1<-ggplot(tf_data, aes(x=`primaryDownstreamJunctionSection/avgSpeed`)) +
  geom_density(color="darkblue", fill="lightblue")+
  theme_classic()
avg2<-ggplot(tf_data, aes(x=`primaryUpstreamJunctionSection/avgSpeed`)) +
  geom_density(color="darkblue", fill="#561179")+
  theme_classic()
avg3<-ggplot(tf_data, aes(x=`secondaryDownstreamJunctionSection/avgSpeed`)) +
  geom_density(color="darkblue", fill="#991111")+
  theme_classic()
avg4<-ggplot(tf_data, aes(x=`secondaryUpstreamJunctionSection/avgSpeed`)) +
  geom_density(color="darkblue", fill="#194199")+
  theme_classic()

ggarrange(avg1, avg2, avg3, avg4, ncol=2, nrow=2)

#check avg speed spread on the NB and SB per day############################################################################
PDn_avgSpeed_bp <- ggplot(tf_data, aes(x=date, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = date)) +
  geom_boxplot() + 
  xlab("")
PDn_avgSpeed_bp
SDn_avgSpeed_bp <- ggplot(tf_data, aes(x=date, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")
SDn_avgSpeed_bp
PUp_avgSpeed_bp<- ggplot(tf_data, aes(x=date, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")
PUp_avgSpeed_bp
SUp_avgSpeed_bp <- ggplot(tf_data, aes(x=date, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")
SUp_avgSpeed_bp
ggarrange(PDn_avgSpeed_bp, SDn_avgSpeed_bp, PUp_avgSpeed_bp, SUp_avgSpeed_bp, ncol=2, nrow=2)


#check traffic by time#####################################################################################################
PDn_avgSpeed_time_bp1 <- ggplot(tf_data1, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample1: Daily traffic")

SDn_avgSpeed_time_bp1 <- ggplot(tf_data1, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_time_bp1 <- ggplot(tf_data1, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_time_bp1 <- ggplot(tf_data1, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_time_bp1, SDn_avgSpeed_time_bp1, PUp_avgSpeed_time_bp1, SUp_avgSpeed_time_bp1, ncol=2, nrow=2)

PDn_avgSpeed_time_bp2 <- ggplot(tf_data2, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample2: Daily traffic")

SDn_avgSpeed_time_bp2 <- ggplot(tf_data2, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_time_bp2 <- ggplot(tf_data2, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_time_bp2 <- ggplot(tf_data2, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_time_bp2, SDn_avgSpeed_time_bp2, PUp_avgSpeed_time_bp2, SUp_avgSpeed_time_bp2, ncol=2, nrow=2)

PDn_avgSpeed_time_bp3 <- ggplot(tf_data3, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample3: Daily traffic")

SDn_avgSpeed_time_bp3 <- ggplot(tf_data3, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_time_bp3 <- ggplot(tf_data3, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_time_bp3 <- ggplot(tf_data3, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_time_bp3, SDn_avgSpeed_time_bp3, PUp_avgSpeed_time_bp3, SUp_avgSpeed_time_bp3, ncol=2, nrow=2)

PDn_avgSpeed_time_bp4 <- ggplot(tf_data4, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample4: Daily traffic")

SDn_avgSpeed_time_bp4 <- ggplot(tf_data4, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_time_bp4 <- ggplot(tf_data4, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_time_bp4 <- ggplot(tf_data4, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = time)) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_time_bp4, SDn_avgSpeed_time_bp4, PUp_avgSpeed_time_bp4, SUp_avgSpeed_time_bp4, ncol=2, nrow=2)

#check speed time and day##################################################################################################
ggplot(data=tf_data, aes(x= wday(date, label = TRUE), y=`primaryDownstreamJunctionSection/avgSpeed`, color = time))+
  geom_point()+
  geom_smooth(method = lm, formula= y~x)+
  labs(title = "Scatterplot: Speed vs time",caption = "Data: Traffic England/ w21007844")

speed_junc<-ggplot(data=tf_data, aes(x= junctionName, y=`primaryDownstreamJunctionSection/avgSpeed`, color = time))+
  geom_point()+
  geom_smooth(method = lm, formula= y~x)+
  labs(title = "Scatterplot: Speed vs time",caption = "Data: Traffic England/ w21007844")
speed_junc + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#Check the access to destinations 

nb_chk_limited_access <- ggplot(tf_data, aes(x=`primaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `primaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")

nb_chk_limited_access + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
prop.table(table(tf_data$`primaryDownstreamJunctionSection/downStreamJunctionDestination`))

sb_chk_limited_access <- ggplot(tf_data, aes(x=`secondaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `secondaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")

sb_chk_limited_access + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
prop.table(table(tf_data$`secondaryDownstreamJunctionSection/downStreamJunctionDestination`))

#Compare Weekly traffic

PDn_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample1: Weekly traffic")

SDn_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp1, SDn_avgSpeed_week_bp1, PUp_avgSpeed_week_bp1, SUp_avgSpeed_week_bp1, ncol=2, nrow=2)

PDn_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample2: Weekly traffic")

SDn_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp2, SDn_avgSpeed_week_bp2, PUp_avgSpeed_week_bp2, SUp_avgSpeed_week_bp2, ncol=2, nrow=2)

PDn_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample3: Weekly traffic")

SDn_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp3, SDn_avgSpeed_week_bp3, PUp_avgSpeed_week_bp3, SUp_avgSpeed_week_bp3, ncol=2, nrow=2)

PDn_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=time, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample4: Weekly traffic")

SDn_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=time, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=time, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=time, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp4, SDn_avgSpeed_week_bp4, PUp_avgSpeed_week_bp4, SUp_avgSpeed_week_bp4, ncol=2, nrow=2)

##################################################################################################################################
#Compare Week by day traffic

PDn_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=date, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample1: Week by day traffic")

SDn_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=date, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=date, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp1 <- ggplot(tf_data1, aes(x=date, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp1, SDn_avgSpeed_week_bp1, PUp_avgSpeed_week_bp1, SUp_avgSpeed_week_bp1, ncol=2, nrow=2)

PDn_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=date, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample2: Week by day traffic")

SDn_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=date, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=date, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp2 <- ggplot(tf_data2, aes(x=date, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp2, SDn_avgSpeed_week_bp2, PUp_avgSpeed_week_bp2, SUp_avgSpeed_week_bp2, ncol=2, nrow=2)

PDn_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=date, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample3: Week by day traffic")

SDn_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=date, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=date, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp3 <- ggplot(tf_data3, aes(x=date, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp3, SDn_avgSpeed_week_bp3, PUp_avgSpeed_week_bp3, SUp_avgSpeed_week_bp3, ncol=2, nrow=2)

PDn_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=date, y=`primaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(title = "Sample4: Week by day traffic")

SDn_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=date, y=`secondaryDownstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

PUp_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=date, y=`primaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")

SUp_avgSpeed_week_bp4 <- ggplot(tf_data4, aes(x=date, y=`secondaryUpstreamJunctionSection/avgSpeed`, fill = wday(date, label = TRUE))) +
  geom_boxplot() + 
  xlab("")+
  labs(caption = "Data: Traffic England/ w21007844")

ggarrange(PDn_avgSpeed_week_bp4, SDn_avgSpeed_week_bp4, PUp_avgSpeed_week_bp4, SUp_avgSpeed_week_bp4, ncol=2, nrow=2)
##################################################################################################################################

tf_data1$comformity<-tf_data1$`primaryDownstreamJunctionSection/links/0/speedLimit`- tf_data1$`primaryDownstreamJunctionSection/avgSpeed`
tf_data1$comformity<-tf_data1$comformity*-1

conformity1<-ggplot(tf_data1, aes(x=junctionName, y=comformity, fill = junctionName)) +
  geom_boxplot() + 
  xlab("")+
  ylab('')+
  labs(title = "Sample1: Checking speed violation")

conformity1 + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

tf_data2$comformity<-tf_data2$`primaryDownstreamJunctionSection/links/0/speedLimit`- tf_data2$`primaryDownstreamJunctionSection/avgSpeed`
tf_data2$comformity<-tf_data2$comformity*-1

conformity2<-ggplot(tf_data2, aes(x=junctionName, y=comformity, fill = junctionName)) +
  geom_boxplot() + 
  xlab("")+
  ylab('')+
  labs(title = "Sample2: Checking speed violation")

conformity2 + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

tf_data3$comformity<-tf_data3$`primaryDownstreamJunctionSection/links/0/speedLimit`- tf_data3$`primaryDownstreamJunctionSection/avgSpeed`
tf_data3$comformity<-tf_data3$comformity*-1

conformity3<-ggplot(tf_data3, aes(x=junctionName, y=comformity, fill = junctionName)) +
  geom_boxplot() + 
  xlab("")+
  ylab('')+
  labs(title = "Sample3: Checking speed violation")

conformity3 + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

tf_data4$comformity<-tf_data4$`primaryDownstreamJunctionSection/links/0/speedLimit`- tf_data4$`primaryDownstreamJunctionSection/avgSpeed`
tf_data4$comformity<-tf_data4$comformity*-1

conformity4<-ggplot(tf_data4, aes(x=junctionName, y=comformity, fill = junctionName)) +
  geom_boxplot() + 
  xlab("")+
  ylab('')+
  labs(title = "Sample4: Checking speed violation")

conformity4 + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# https://www.datasciencecentral.com/difference-between-stratified-sampling-cluster-sampling-and-quota/
#Replacing the null values by the 0 will affect the mean and subsequently the sd
#best way would be to delete the null rows
#Watch out for J7 and J14, they are key to this evaluation.

nb_chk_limited_access1 <- ggplot(tf_data1, aes(x=`primaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `primaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")+
  labs(title = "Sample1: Checking road accessibility")
nb_chk_limited_access1+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
nb_chk_limited_access2 <- ggplot(tf_data2, aes(x=`primaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `primaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")+
  labs(title = "Sample2: Checking road accessibility")
nb_chk_limited_access2+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
nb_chk_limited_access3 <- ggplot(tf_data3, aes(x=`primaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `primaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")+
  labs(title = "Sample3: Checking road accessibility")
nb_chk_limited_access3+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
nb_chk_limited_access4 <- ggplot(tf_data4, aes(x=`primaryDownstreamJunctionSection/downStreamJunctionDestination`, fill = `primaryDownstreamJunctionSection/downStreamJunctionDestination`)) +
  geom_bar()+ 
  xlab("Destination")+
  labs(title = "Sample4: Checking road accessibility")
nb_chk_limited_access4+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

check_cor_p<- cor.test(tf_data_o$`primaryUpstreamJunctionSection/avgSpeed`, tf_data_o$`primaryDownstreamJunctionSection/avgSpeed`, method = 'pearson')
check_cor_p

m<-lm(`primaryUpstreamJunctionSection/avgSpeed`~`primaryUpstreamJunctionSection/avgSpeed`, data= tf_data_o)
summary(m)
